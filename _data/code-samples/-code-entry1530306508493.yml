_id: 919baeb0-7be0-11e8-91bc-f795b759aa50
author: whicker Credit to Apache85
notes: >-
  Weather function - returns weather report, not just cloud number. You can run
  this every hour or 4 hours to give a current weather report. Some of the
  message is hard coded (area I think).
code: "function DTG(TimeVar) \r\nif TimeVar == nil then \r\nTimeVar = ScenEdit_CurrentTime() \r\nend \r\nlocal msgtime = os.date(\"!%d%H%M\" .. \"Z\" .. \" \" .. \"%b %y\", TimeVar) \r\nlocal msgtime = string.upper(msgtime) \r\nreturn msgtime \r\nend \r\n\r\nfunction Round(num, numDecimalPlaces) \r\nlocal mult = 10^(numDecimalPlaces or 0) \r\nreturn math.floor(num * mult + 0.5) / mult \r\nend \r\n\r\nfunction ACP126(rec_station,snd_station,precedence,from,to,classification,body) \r\n--rec_station --4 letter code (e.g. YDCX) \r\n--snd_station --4 letter code +/- NR 3 number (e.g. YBDN NR 270) \r\n--precedence --Flash (Z), Immediate (O), Priority (P), Routine (R), Flash Override (Y) \r\nlocal dtg = DTG() \r\n--from --e.g. MET FLT OPS \r\n--to --e.g. SSN 21 SEAWOLF \r\n--classification --Unclass +/- SBU / FOUO / NOFORN (Restricted), Confidential, Secret, Top Secret \r\n--body \r\n_,gr = body:gsub(\"%S+\",\"\") \r\nlocal sig_string = string.upper('<P><FONT face=Consolas>'..rec_station..' <BR>'.. \r\n'DE '..snd_station..' <BR>'.. \r\nprecedence..' '..dtg..' <BR>'.. \r\n'fm '..from..' <BR>'.. \r\n'to '..to..' <BR>'.. \r\n'wd gr'..gr..' <BR>'.. \r\n'bt <BR>'.. \r\nclassification..' <BR>'.. \r\nbody..' <BR>'.. \r\n'bt <BR>'.. \r\n'nnnn </P>') \r\nreturn sig_string \r\nend \r\n\r\nfunction WeatherReport(outlook) \r\nif outlook == nil then outlook = 'next forecast at '..DTG(ScenEdit_CurrentTime()+21600) end \r\n--Generate special message to player \r\nlocal weather = ScenEdit_GetWeather() --Get new weather parameters \r\nlocal temp, cloud, rain, sea = weather.temp, weather.undercloud, weather.rainfall, weather.seastate \r\n\r\nlocal f_temp = Round((temp*1.8) + 32,0) --Convert to Fahrenheit \r\n\r\n--create rain/precipitation descriptor (based on in-game descriptions) \r\nif rain == 0 then precipdesc = 'nil' \r\nelseif rain < 5 then precipdesc = 'very light' \r\nelseif rain < 11 then precipdesc = 'light' \r\nelseif rain < 20 then precipdesc = 'moderate' \r\nelseif rain < 30 then precipdesc = 'heavy' \r\nelseif rain < 40 then precipdesc = 'very heavy' \r\nelse precipdesc = 'extreme' \r\nend \r\n\r\n--create cloud descriptor (based on in-game descriptions) \r\nif cloud == 0 then clouddesc = 'clear skies' \r\nelseif cloud < 0.2 then clouddesc = 'light low clouds' \r\nelseif cloud < 0.3 then clouddesc = 'light middle clouds' \r\nelseif cloud < 0.4 then clouddesc = 'light high clouds' \r\nelseif cloud < 0.5 then clouddesc = 'moderate low clouds' \r\nelseif cloud < 0.6 then clouddesc = 'moderate middle clouds' \r\nelseif cloud < 0.7 then clouddesc = 'moderate high clouds' \r\nelseif cloud < 0.8 then clouddesc = 'moderate middle clouds & light high clouds' \r\nelseif cloud < 0.9 then clouddesc = 'solid middle clouds & moderate high clouds' \r\nelseif cloud < 1.0 then clouddesc = 'thin fog & solid cloud cover' \r\nelse clouddesc = 'thick fog & solid cloud cover' \r\nend \r\n\r\n--rec_station,snd_station,precedence,from,to,classification,body \r\nlocal wx_time = DTG() \r\nlocal wx_report = ACP126('NEWC','JOCMETOPS','r','HQJOC METEOROLOGICAL OFFICE','FFG 06 NEWCASTLE <BR> INFO ALL STATIONS','unclass','WX REPORT ' .. wx_time .. ' - EAST COAST AND BASS STRAIT <BR>AVERAGE TEMP '.. temp ..'°C / '..f_temp..'°F <BR> SEA STATE '.. sea ..' <BR>'..precipdesc..' PRECIPITATION <BR>'..clouddesc..'<BR>'..outlook) \r\nScenEdit_SpecialMessage('playerside',wx_report) \r\nend \r\n\r\nWeatherReport()"
date: 1530306508
