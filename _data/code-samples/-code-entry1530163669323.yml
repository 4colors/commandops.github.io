_id: fee4d170-7a93-11e8-b5f4-6170e8cb26a5
author: whicker
notes: >-
  Weather: Night and Morning Low Clouds Part 2 - This goes in an event that triggers every 30 minutes.
code: "math.randomseed(os.time());\r\nlocal scenarioWeather = ScenEdit_GetWeather();\r\nlocal clouds = scenarioWeather.undercloud;\r\n-- Check and set hour, used to track hour of day\r\nlocal halfHour = ScenEdit_GetKeyValue(\"HalfHour\");\r\nhalfHour = tonumber(halfHour);\r\n-- early clouds is used for the early morning hours to have the change be slower\r\nlocal earlyClouds = ScenEdit_GetKeyValue(\"EarlyClouds\");\r\nearlyClouds = tonumber(earlyClouds);\r\nprint(\"halfHour = \" ..halfHour);\r\nprint(\"early clouds = \" ..earlyClouds);\r\n\r\nif halfHour >=0 and halfHour <=10  then\r\nhalfHour = halfHour + 1;\r\nlocal rain = 0;\r\nlocal seas = 1\r\n-- if there is heavy fog add light rain\r\n\tif earlyClouds >= 1.06 then \r\n\t\train = 4;\r\n\t\tseas = 3\r\n\tend\r\nScenEdit_SetWeather(28,rain,earlyClouds,seas);\r\nScenEdit_SetKeyValue(\"HalfHour\", tostring(halfHour));\r\nearlyClouds = earlyClouds - .02;\r\nScenEdit_SetKeyValue(\"EarlyClouds\", tostring(earlyClouds));\r\n\r\nelseif halfHour >= 11 and halfHour <=35 then\r\nclouds = clouds - .04;\r\n  if clouds <= .05 then clouds = 0;\r\n  end\r\nhalfHour = halfHour + 1;\r\nScenEdit_SetWeather(31,0,clouds,2);\r\nScenEdit_SetKeyValue(\"HalfHour\", tostring(halfHour));\r\n\r\nelseif halfHour >=36 and halfHour <=46 then\r\nclouds = clouds +.07;\r\nhalfHour = halfHour + 1;\r\nScenEdit_SetWeather(29,0,clouds,3);\r\nScenEdit_SetKeyValue(\"HalfHour\", tostring(halfHour));\r\n\r\nelseif halfHour == 47 then\r\nclouds = .7;\r\nhalfHour = 0;\r\nScenEdit_SetWeather(29,0,clouds,2);\r\nlocal w = ScenEdit_GetWeather();\r\nlocal wtemp = w.temp;\r\nlocal wclouds = w.undercloud;\r\nlocal wseas = w.seastate;\r\nlocal wrain = w.rainfall;\r\nScenEdit_SetKeyValue(\"HalfHour\", tostring(halfHour));\r\n--reset earlyClouds - random, 1.1 is heavy fog, .7 is cloudy\r\nearlyClouds = math.random(7,11)/10;\r\nScenEdit_SetKeyValue(\"EarlyClouds\", tostring(earlyClouds));\r\nprint (earlyClouds);\r\nlocal TimeVar = ScenEdit_CurrentTime();\r\nTimeVar = TimeVar + 7200; --adjust time to key west\r\nlocal time = (os.date(\"%A %B %d %H%M \",TimeVar));\r\n\r\nlocal fogMessage = \"\";\r\nlocal veryHeavyFog = \"*****VERY HEAVY FOG TONIGHT, LIGHT RAIN*****<br><br>We expect to see very heavy fog and light rain starting in the next 30-40 minutes, the Sea State will also increase slightly while it is raining. The rain should not last long. The fog will last for several hours, then should begin to clear by 0600. Solid low clouds will persist till mid morning. We expect clear skies for at least an hour or two in the late afternoon.\"\r\nlocal heavyFog = \"***HEAVY FOG TONIGHT***<br><br>We expect to see heavy fog starting in the next 30-40 minutes, lasting for several hours. The fog should begin to clear by 0430. Solid low clouds will persist till mid morning. We expect clear skies for at least an hour or two in the late afternoon.\"\r\nlocal moderateFog = \"**MODERATE FOG TONIGHT**<br><br>We expect to see fog tonight starting in the next 30-40 minutes, lasting for a couple hours. The fog should begin to clear by 0300. Solid low clouds should start to break up by early morning. We expect clear skies for a few hours this afternoon.\"\r\n--local lightFog = \"***LIGHT FOG TONIGHT*** We expect to see fog tonight starting in the next hour, lasting for an hour or so. It should clear quickly and we still expect clear skies for several hours this afternoon.\"\r\nlocal noFog = \"No fog tonight, skies should be clear by late morning with several hours of clear skies.\"\r\n  \tif earlyClouds <= .8 then fogMessage = noFog;\r\n  \t\telseif earlyClouds == .9 then fogMessage = moderateFog;\r\n  \t\t\telseif earlyClouds == 1 then fogMessage = heavyFog;\r\n  \t\t\t\telseif earlyClouds == 1.1 then fogMessage = veryHeavyFog;\r\n  \t\t\tend\r\n\r\nScenEdit_SpecialMessage(ScenEdit_PlayerSide(), '<div style=\"text-transform: uppercase;font-family:Courier New;\"><p>' .. time .. ' (KeyWest)</p><P>COMMANDER,</P><P>CURRENT WEATHER REPORT,</P> TEMPERATURE: ' .. wtemp .. 'C (High: 41C, Low: 25C) <br>RAIN STATE: ' .. wrain .. '<br>CLOUD LEVEL: Moderate middle clouds, 7-16k feet, light high clouds 27-30k feet<br>SEA STATE: ' .. wseas .. '<p>' .. fogMessage .. '</p><p>It looks like the weather for the next few days should be more of the same, night and morning low clouds with a chance of fog in the very early morning hours.</p><p>Sea State has been fairly mild, usually 1-2 in the early morning, increasing to 3 in the afternoon and evening.</p></div>');\r\nelse\r\n print(\"Something is wrong, halfhour not set?\");\r\nend\r\n\r\nprint(ScenEdit_GetWeather());"
date: 1530163669
